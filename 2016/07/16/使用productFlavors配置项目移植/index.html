
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>使用productFlavors配置项目移植 | JrDong’s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="JrDong">
    
    <meta name="description" content="使用productFlavors配置项目移植概述有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.如果项目多的话会很不好">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c00e8927384103b054b92a9d4b05f4aa";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="JrDong’s Blog" title="JrDong’s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="JrDong’s Blog">JrDong’s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">博客</a></li>
					
						<li><a href="/archives">存档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:ibat.xyz">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/16/使用productFlavors配置项目移植/" title="使用productFlavors配置项目移植" itemprop="url">使用productFlavors配置项目移植</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://ibat.xyz" title="JrDong">JrDong</a>
    </p>
  <p class="article-time">
    <time datetime="2016-07-16T14:32:15.000Z" itemprop="datePublished">2016-07-16</time>
    更新日期:<time datetime="2016-11-19T14:33:52.000Z" itemprop="dateModified">2016-11-19</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u4F7F_u7528productFlavors_u914D_u7F6E_u9879_u76EE_u79FB_u690D"><span class="toc-number">1.</span> <span class="toc-text">使用productFlavors配置项目移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u6982_u8FF0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flavor"><span class="toc-number">1.2.</span> <span class="toc-text">Flavor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5728_u4E3B_u9879_u76EEbuild-gradle_u4E2D_u914D_u7F6EproductFlavors"><span class="toc-number">1.2.1.</span> <span class="toc-text">在主项目build.gradle中配置productFlavors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u66FF_u6362_u8D44_u6E90_u6587_u4EF6"><span class="toc-number">1.3.</span> <span class="toc-text">替换资源文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u4F7F_u7528_u7B2C_u4E09_u65B9sdk"><span class="toc-number">1.4.</span> <span class="toc-text">使用第三方sdk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u52A8_u6001_u66FF_u6362_u4EE3_u7801"><span class="toc-number">1.5.</span> <span class="toc-text">动态替换代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u603B_u7ED3"><span class="toc-number">1.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
		</div>
		
		<h1 id="u4F7F_u7528productFlavors_u914D_u7F6E_u9879_u76EE_u79FB_u690D"><a href="#u4F7F_u7528productFlavors_u914D_u7F6E_u9879_u76EE_u79FB_u690D" class="headerlink" title="使用productFlavors配置项目移植"></a>使用productFlavors配置项目移植</h1><h2 id="u6982_u8FF0"><a href="#u6982_u8FF0" class="headerlink" title="概述"></a>概述</h2><p>有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.<br>我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.<br>如果项目多的话会很不好维护.下面就介绍怎样通过productFlavors的方式配置项目移植. </p>
<h2 id="Flavor"><a href="#Flavor" class="headerlink" title="Flavor"></a>Flavor</h2><h3 id="u5728_u4E3B_u9879_u76EEbuild-gradle_u4E2D_u914D_u7F6EproductFlavors"><a href="#u5728_u4E3B_u9879_u76EEbuild-gradle_u4E2D_u914D_u7F6EproductFlavors" class="headerlink" title="在主项目build.gradle中配置productFlavors"></a>在主项目build.gradle中配置productFlavors</h3><pre><code>android{
    ...
    defaultConfig{
    ...
    }
    productFlavors{
        jkxt {
            applicationId &quot;com.****.****&quot;
            buildConfigField &quot;String&quot;, &quot;PROJECT_SIGN&quot;, &quot;\&quot;jkxt\&quot;&quot;
            manifestPlaceholders = [BAIDU_CHANNEL_VALUE       : &quot;*****&quot;,
                                    PACKAGE_NAME              : &quot;*****&quot;]
        }
        jkhd {
            applicationId &quot;com.****.****&quot;
            buildConfigField &quot;String&quot;, &quot;PROJECT_SIGN&quot;, &quot;\&quot;jkhd\&quot;&quot;
            manifestPlaceholders = [BAIDU_CHANNEL_VALUE       : &quot;*****&quot;,
                                    PACKAGE_NAME              : &quot;*****&quot;]
        }
    }
}
</code></pre><p>上面定义了一个productFlavors,gradle会为这个flavor关联对应的sourceSet,默认位置为src/<flavorname>目录,对应到本例就是src/jkhd,如果没有建文件夹,则默认为src/main.看如下解释</flavorname></p>
<blockquote>
<p>#####The product flavors support the same properties as defaultConfig—this is because defaultConfig actually belongs to the ProductFlavor class. This means you can provide the base configuration for all flavors in the defaultConfig {} block, and each flavor can override any of these default values, such as the applicationId.  </p>
</blockquote>
<p>也就是说,defaultConfig中可以配置的属性,比如applicationId,minSdkVersion等,都可以在productFlavors中配置,因为<strong>defaultConfig就是一个productFlavor实例</strong>.</p>
<p>在本例中,解释上面两个属性,<strong>buildConfigField</strong>可以理解为定义一个常量,传入的值分别代表type,name,value;<br>通过BuildConfig.PROJECT_SIGN  可以拿到相应的值,比如我们熟悉的BuildConfig.DEBUG,就是系统定义的一个常量.  </p>
<p><strong>manifestPlaceholders</strong>作用是动态替换manifest文件,传入的是一个map对象,写法如上所示.在配置多个项目时,一些第三方的key比如友盟,极光等需要进行动态配置,就需要用到这个属性,在manifest文件中把需要动态配置的属性按如下写法,android:name=”${PACKAGE_NAME}”</p>
<h2 id="u66FF_u6362_u8D44_u6E90_u6587_u4EF6"><a href="#u66FF_u6362_u8D44_u6E90_u6587_u4EF6" class="headerlink" title="替换资源文件"></a>替换资源文件</h2><p>上面讲到productFlavors已经为我们关联了对应的sourceSet,所以我们只需要把不同的资源文件放入相应目录下<br>以jkhd为例,在src/jkhd目录下新建res文件,新建需要替换的资源文件夹,比如需要替换app_name<br>只需要在src/jkhd/res/values/string.xml,新建app_name标签即可.<strong>其他公用的资源不需要添加,找不到的话会默认从主项目下面找</strong>.</p>
<h2 id="u4F7F_u7528_u7B2C_u4E09_u65B9sdk"><a href="#u4F7F_u7528_u7B2C_u4E09_u65B9sdk" class="headerlink" title="使用第三方sdk"></a>使用第三方sdk</h2><p>做某些项目可能用用到不用的第三方sdk,但其他项目并不需要这个sdk,那么怎么为特定的项目添加sdk呢?   </p>
<pre><code>android {
productFlavors {
    jkhd {
        }
    }
}
...
dependencies {
    jkhdCompile &apos;com.nineoldandroids:library:2.4.0&apos;
}
</code></pre><p>然后通过反射的方法,进行具体判断</p>
<pre><code>class MyActivity extends Activity {
private boolean useSdk;

@override
public void onCreate(Bundle savedInstanceState) {
    try {
        Class.forName(&quot;com.nineoldandroids.......&quot;);
        useSdk = true;
    } catch (ClassNotFoundException ignored) {
        }
    }
}
</code></pre><h2 id="u52A8_u6001_u66FF_u6362_u4EE3_u7801"><a href="#u52A8_u6001_u66FF_u6362_u4EE3_u7801" class="headerlink" title="动态替换代码"></a>动态替换代码</h2><ol>
<li>如果在src/jkhd目录下新建同名类的话会报类重复的问题.但我们可以新建src/jkhd,和src/jkxt两个文件夹,在这两个文件夹中同时写入一个与主目录不同的类,在主目录中进行调用,这样是没有问题的  </li>
<li>直接在主目录中以判断标记位的方法来达到动态替换的效果.  </li>
</ol>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h2><p>productFlavors对于配置项目移植,和多渠道打包都非常方便,节省了我们大量的工作.目前所介绍的配置基本上可以满足我们的需求.以后再也不用担心多渠道打包和项目移植啦~  </p>
<p>欢迎大家提出更多新的用法!</p>
<p>参考资料<br><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-flavors" target="_blank" rel="external">Product-flavors</a><br><a href="http://tech.meituan.com/mt-apk-adaptation.html" target="_blank" rel="external">美团Android自动化之旅—适配渠道包</a></p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" data-title="使用productFlavors配置项目移植 | JrDong’s Blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/08/23/理解RSA算法/" title="理解RSA算法">
  <strong>PREVIOUS:</strong><br/>
  <span>
  理解RSA算法</span>
</a>
</div>


<div class="next">
<a href="/2016/06/28/Android-资料整理/"  title="Android--参考资料">
 <strong>NEXT:</strong><br/> 
 <span>Android--参考资料
</span>
</a>
</div>

</nav>

 	 
<section class="comment">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key=”2016/07/16/使用productFlavors配置项目移植/” data-title=”使用productFlavors配置项目移植”  data-url="http://ibat.xyz/http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ibat"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u4F7F_u7528productFlavors_u914D_u7F6E_u9879_u76EE_u79FB_u690D"><span class="toc-number">1.</span> <span class="toc-text">使用productFlavors配置项目移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u6982_u8FF0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flavor"><span class="toc-number">1.2.</span> <span class="toc-text">Flavor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5728_u4E3B_u9879_u76EEbuild-gradle_u4E2D_u914D_u7F6EproductFlavors"><span class="toc-number">1.2.1.</span> <span class="toc-text">在主项目build.gradle中配置productFlavors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u66FF_u6362_u8D44_u6E90_u6587_u4EF6"><span class="toc-number">1.3.</span> <span class="toc-text">替换资源文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u4F7F_u7528_u7B2C_u4E09_u65B9sdk"><span class="toc-number">1.4.</span> <span class="toc-text">使用第三方sdk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u52A8_u6001_u66FF_u6362_u4EE3_u7801"><span class="toc-number">1.5.</span> <span class="toc-text">动态替换代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u603B_u7ED3"><span class="toc-number">1.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android/" title="Android">Android<sup>11</sup></a></li>
		
			<li><a href="/categories/markdown/" title="markdown">markdown<sup>1</sup></a></li>
		
			<li><a href="/categories/学习笔记/" title="学习笔记">学习笔记<sup>1</sup></a></li>
		
			<li><a href="/categories/算法/" title="算法">算法<sup>2</sup></a></li>
		
		</ul>
</div>


  

  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> “业精于勤而荒于嬉” <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2017 
		
		<a href="http://ibat.xyz" target="_blank" title="JrDong">JrDong</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"ibat"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





     </body>
</html>

<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>使用productFlavors配置项目移植 | JrDong’s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="使用productFlavors配置项目移植概述有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.如果项目多的话会很不好维护.下面就介绍怎样通过productFlavors的方式配置项目移植.  Flavor在主项目bu">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="使用productFlavors配置项目移植">
<meta property="og:url" content="http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/index.html">
<meta property="og:site_name" content="JrDong’s Blog">
<meta property="og:description" content="使用productFlavors配置项目移植概述有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.如果项目多的话会很不好维护.下面就介绍怎样通过productFlavors的方式配置项目移植.  Flavor在主项目bu">
<meta property="og:updated_time" content="2016-11-19T14:33:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用productFlavors配置项目移植">
<meta name="twitter:description" content="使用productFlavors配置项目移植概述有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.如果项目多的话会很不好维护.下面就介绍怎样通过productFlavors的方式配置项目移植.  Flavor在主项目bu">
    
        <link rel="alternate" type="application/atom+xml" title="JrDong’s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@1.6.1/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">JrDong</h5>
          <a href="mailto:idongjr@gmail.com" title="idongjr@gmail.com" class="mail">idongjr@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/todo"  >
                <i class="icon icon-lg icon-link"></i>
                TODO
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/JrDong" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">使用productFlavors配置项目移植</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">使用productFlavors配置项目移植</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-07-16T14:32:15.000Z" itemprop="datePublished" class="page-time">
  2016-07-16
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用productFlavors配置项目移植"><span class="post-toc-number">1.</span> <span class="post-toc-text">使用productFlavors配置项目移植</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Flavor"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Flavor</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在主项目build-gradle中配置productFlavors"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">在主项目build.gradle中配置productFlavors</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#替换资源文件"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">替换资源文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用第三方sdk"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">使用第三方sdk</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#动态替换代码"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">动态替换代码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">总结</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-使用productFlavors配置项目移植"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">使用productFlavors配置项目移植</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-07-16 22:32:15" datetime="2016-07-16T14:32:15.000Z"  itemprop="datePublished">2016-07-16</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="使用productFlavors配置项目移植"><a href="#使用productFlavors配置项目移植" class="headerlink" title="使用productFlavors配置项目移植"></a>使用productFlavors配置项目移植</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>有时候需要做两个或多个项目,但都用的同一套代码.只有稍微的一些布局或者代码的改动.<br>我们常规的做法是再切一个分支,再在这个分支上做相应的改动.但比如发现了某一处bug,或者需要统一改个需求.那我们就需要在每一个分支上都进行这种变动.<br>如果项目多的话会很不好维护.下面就介绍怎样通过productFlavors的方式配置项目移植. </p>
<h2 id="Flavor"><a href="#Flavor" class="headerlink" title="Flavor"></a>Flavor</h2><h3 id="在主项目build-gradle中配置productFlavors"><a href="#在主项目build-gradle中配置productFlavors" class="headerlink" title="在主项目build.gradle中配置productFlavors"></a>在主项目build.gradle中配置productFlavors</h3><pre><code>android{
    ...
    defaultConfig{
    ...
    }
    productFlavors{
        jkxt {
            applicationId &quot;com.****.****&quot;
            buildConfigField &quot;String&quot;, &quot;PROJECT_SIGN&quot;, &quot;\&quot;jkxt\&quot;&quot;
            manifestPlaceholders = [BAIDU_CHANNEL_VALUE       : &quot;*****&quot;,
                                    PACKAGE_NAME              : &quot;*****&quot;]
        }
        jkhd {
            applicationId &quot;com.****.****&quot;
            buildConfigField &quot;String&quot;, &quot;PROJECT_SIGN&quot;, &quot;\&quot;jkhd\&quot;&quot;
            manifestPlaceholders = [BAIDU_CHANNEL_VALUE       : &quot;*****&quot;,
                                    PACKAGE_NAME              : &quot;*****&quot;]
        }
    }
}
</code></pre><p>上面定义了一个productFlavors,gradle会为这个flavor关联对应的sourceSet,默认位置为src/<flavorname>目录,对应到本例就是src/jkhd,如果没有建文件夹,则默认为src/main.看如下解释</flavorname></p>
<blockquote>
<p>#####The product flavors support the same properties as defaultConfig—this is because defaultConfig actually belongs to the ProductFlavor class. This means you can provide the base configuration for all flavors in the defaultConfig {} block, and each flavor can override any of these default values, such as the applicationId.  </p>
</blockquote>
<p>也就是说,defaultConfig中可以配置的属性,比如applicationId,minSdkVersion等,都可以在productFlavors中配置,因为<strong>defaultConfig就是一个productFlavor实例</strong>.</p>
<p>在本例中,解释上面两个属性,<strong>buildConfigField</strong>可以理解为定义一个常量,传入的值分别代表type,name,value;<br>通过BuildConfig.PROJECT_SIGN  可以拿到相应的值,比如我们熟悉的BuildConfig.DEBUG,就是系统定义的一个常量.  </p>
<p><strong>manifestPlaceholders</strong>作用是动态替换manifest文件,传入的是一个map对象,写法如上所示.在配置多个项目时,一些第三方的key比如友盟,极光等需要进行动态配置,就需要用到这个属性,在manifest文件中把需要动态配置的属性按如下写法,android:name=”${PACKAGE_NAME}”</p>
<h2 id="替换资源文件"><a href="#替换资源文件" class="headerlink" title="替换资源文件"></a>替换资源文件</h2><p>上面讲到productFlavors已经为我们关联了对应的sourceSet,所以我们只需要把不同的资源文件放入相应目录下<br>以jkhd为例,在src/jkhd目录下新建res文件,新建需要替换的资源文件夹,比如需要替换app_name<br>只需要在src/jkhd/res/values/string.xml,新建app_name标签即可.<strong>其他公用的资源不需要添加,找不到的话会默认从主项目下面找</strong>.</p>
<h2 id="使用第三方sdk"><a href="#使用第三方sdk" class="headerlink" title="使用第三方sdk"></a>使用第三方sdk</h2><p>做某些项目可能用用到不用的第三方sdk,但其他项目并不需要这个sdk,那么怎么为特定的项目添加sdk呢?   </p>
<pre><code>android {
productFlavors {
    jkhd {
        }
    }
}
...
dependencies {
    jkhdCompile &apos;com.nineoldandroids:library:2.4.0&apos;
}
</code></pre><p>然后通过反射的方法,进行具体判断</p>
<pre><code>class MyActivity extends Activity {
private boolean useSdk;

@override
public void onCreate(Bundle savedInstanceState) {
    try {
        Class.forName(&quot;com.nineoldandroids.......&quot;);
        useSdk = true;
    } catch (ClassNotFoundException ignored) {
        }
    }
}
</code></pre><h2 id="动态替换代码"><a href="#动态替换代码" class="headerlink" title="动态替换代码"></a>动态替换代码</h2><ol>
<li>如果在src/jkhd目录下新建同名类的话会报类重复的问题.但我们可以新建src/jkhd,和src/jkxt两个文件夹,在这两个文件夹中同时写入一个与主目录不同的类,在主目录中进行调用,这样是没有问题的  </li>
<li>直接在主目录中以判断标记位的方法来达到动态替换的效果.  </li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>productFlavors对于配置项目移植,和多渠道打包都非常方便,节省了我们大量的工作.目前所介绍的配置基本上可以满足我们的需求.以后再也不用担心多渠道打包和项目移植啦~  </p>
<p>欢迎大家提出更多新的用法!</p>
<p>参考资料<br><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-flavors" target="_blank" rel="external">Product-flavors</a><br><a href="http://tech.meituan.com/mt-apk-adaptation.html" target="_blank" rel="external">美团Android自动化之旅—适配渠道包</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2016-11-19T14:33:52.000Z" itemprop="dateUpdated">2016-11-19 22:33:52</time>
</span><br>


        这里写留言或版权声明：<a href="/2016/07/16/使用productFlavors配置项目移植/" target="_blank" rel="external">http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/</a>
    </div>
    <footer>
        <a href="http://ibat.xyz">
            <img src="/img/avatar.jpg" alt="JrDong">
            JrDong
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&title=《使用productFlavors配置项目移植》 — JrDong’s Blog&pic=http://ibat.xyz/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&title=《使用productFlavors配置项目移植》 — JrDong’s Blog&source=业精于勤而荒于嬉" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《使用productFlavors配置项目移植》 — JrDong’s Blog&url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&via=http://ibat.xyz" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/06/28/Android-资料整理/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android--参考资料</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/08/23/理解RSA算法/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">理解RSA算法</h4>
      </a>
    </div>
  
</nav>



    

<div class="comments" id="comments">
    <div class="ds-thread" data-thread-key="使用productFlavors配置项目移植" data-title="使用productFlavors配置项目移植" data-url="http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/"></div>
</div>
<script>
lazyScripts.push('//cdn.bootcss.com/marked/0.3.6/marked.min.js');

var duoshuoQuery = {short_name:'ysblog', theme: 'none'};
lazyScripts.push('//unpkg.com/hexo-theme-material-indigo@1.6.1/js/embed.min.js');


</script>










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechat.jpg" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>JrDong &copy; 2015 - 2019</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&title=《使用productFlavors配置项目移植》 — JrDong’s Blog&pic=http://ibat.xyz/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&title=《使用productFlavors配置项目移植》 — JrDong’s Blog&source=业精于勤而荒于嬉" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《使用productFlavors配置项目移植》 — JrDong’s Blog&url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/&via=http://ibat.xyz" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://ibat.xyz/2016/07/16/使用productFlavors配置项目移植/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



</script>

<script src="//unpkg.com/hexo-theme-material-indigo@1.6.1/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@1.6.1/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
